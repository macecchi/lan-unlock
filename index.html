<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>lan unlock</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width = device-width, initial-scale = 1, user-scalable = no">

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: center;
            justify-content: center;

            background: #666;
            -webkit-user-select: none;
            user-select: none;
        }

        body:after {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            content: '';
            z-index: -1;

            background: transparent;
            opacity: 0;
            pointer-events: none;
        }

        body.ok:after {
            background: #060;
            -webkit-animation: blink 500ms;
            animation: blink 500ms;
        }

        body.err:after {
            background: #600;
            -webkit-animation: blink 500ms;
            animation: blink 500ms;
        }

        button {
            display: -webkit-flex;
            display: flex;
            padding: 0;

            -webkit-appearance: none;
            background: #eee;
            border: none;
            box-shadow: 0 10px 16px 2px rgba(0, 0, 0, 0.37);
            color: #fff;
            text-transform: uppercase;
            outline: none;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }

        button:active {
            box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.5);
        }

        button.unlock {
            border-radius: 5px 5px 0 0;
            border-bottom: 1px solid #666;
        }

        button.sleep {
            border-radius: 0 0 5px 5px;
            border-top: 1px solid #fff;
        }

        button img {
            height: 70%;
            margin: auto;
        }



        @media (orientation:landscape) {
            button {
                width: 80vh;
            }

            button.unlock {
                height: 50vh;
            }

            button.sleep {
                height: 25vh;
            }
        }

        @media (orientation:portrait) {
            button {
                width: 80vw;
            }

            button.unlock {
                height: 50vw;
            }

            button.sleep {
                height: 25vw;
            }
        }

        @-webkit-keyframes blink {
            0%, 50%, 100% {
                opacity: 0;
            }
            25%, 75% {
                opacity: 1;
            }
        }

        @keyframes blink {
            0%, 50%, 100% {
                opacity: 0;
            }
            25%, 75% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!--
        icon: "Twemoji 1f513" by Twitter.
        Licensed under CC BY 4.0 via Wikimedia Commons -
        http://commons.wikimedia.org/wiki/File:Twemoji_1f513.svg#mediaviewer/File:Twemoji_1f513.svg
    -->
    <button class="unlock" ontouchstart="">
        <img src="data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%20standalone%3D%22no%22%3F%3E%3Csvg%20xmlns%3Asvg%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20viewBox%3D%220%200%2047.5%2047.5%22%20style%3D%22enable-background%3Anew%200%200%2047.5%2047.5%3B%22%20id%3D%22svg2%22%20xml%3Aspace%3D%22preserve%22%3E%3Cdefs%20id%3D%22defs6%22%3E%3CclipPath%20id%3D%22clipPath18%22%3E%3Cpath%20d%3D%22M%200%2C38%2038%2C38%2038%2C0%200%2C0%200%2C38%20z%22%20id%3D%22path20%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3Cg%20transform%3D%22matrix(1.25%2C0%2C0%2C-1.25%2C0%2C47.5)%22%20id%3D%22g12%22%3E%3Cg%20id%3D%22g14%22%3E%3Cg%20clip-path%3D%22url(%23clipPath18)%22%20id%3D%22g16%22%3E%3Cg%20transform%3D%22translate(19%2C36.9995)%22%20id%3D%22g22%22%3E%3Cpath%20d%3D%22m%200%2C0%20c%20-4.612%2C0%20-8.483%2C-3.126%20-9.639%2C-7.371%20l%203.855%2C-1.052%20C%20-5.09%2C-5.875%20-2.767%2C-4%200%2C-4%20c%203.313%2C0%206%2C-2.687%206%2C-6%20l%200%2C-10%204%2C0%200%2C10%20C%2010%2C-4.477%205.523%2C0%200%2C0%22%20id%3D%22path24%22%20style%3D%22fill%3A%23bcbec0%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%2F%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate(31%2C5)%22%20id%3D%22g26%22%3E%3Cpath%20d%3D%22m%200%2C0%20c%200%2C-2.209%20-1.791%2C-4%20-4%2C-4%20l%20-16%2C0%20c%20-2.209%2C0%20-4%2C1.791%20-4%2C4%20l%200%2C10%20c%200%2C2.209%201.791%2C4%204%2C4%20l%2016%2C0%20c%202.209%2C0%204%2C-1.791%204%2C-4%20L%200%2C0%20z%22%20id%3D%22path28%22%20style%3D%22fill%3A%23ffac33%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E">
    </button>
    <!--
        icon: "Twemoji 1f512" by Twitter.
        Licensed under CC BY 4.0 via Wikimedia Commons -
        http://commons.wikimedia.org/wiki/File:Twemoji_1f513.svg#mediaviewer/File:Twemoji_1f512.svg
    -->
    <button class="sleep" ontouchstart="">
        <img src="data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%20standalone%3D%22no%22%3F%3E%3Csvg%20xmlns%3Asvg%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20viewBox%3D%220%200%2047.5%2047.5%22%20style%3D%22enable-background%3Anew%200%200%2047.5%2047.5%3B%22%20id%3D%22svg2%22%20xml%3Aspace%3D%22preserve%22%3E%3Cdefs%20id%3D%22defs6%22%3E%3CclipPath%20id%3D%22clipPath18%22%3E%3Cpath%20d%3D%22M%200%2C38%2038%2C38%2038%2C0%200%2C0%200%2C38%20z%22%20id%3D%22path20%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3Cg%20transform%3D%22matrix(1.25%2C0%2C0%2C-1.25%2C0%2C47.5)%22%20id%3D%22g12%22%3E%3Cg%20id%3D%22g14%22%3E%3Cg%20clip-path%3D%22url(%23clipPath18)%22%20id%3D%22g16%22%3E%3Cg%20transform%3D%22translate(19%2C32.9995)%22%20id%3D%22g22%22%3E%3Cpath%20d%3D%22m%200%2C0%20c%20-5.523%2C0%20-10%2C-4.477%20-10%2C-10%20l%200%2C-10%204%2C0%200%2C10%20c%200%2C3.313%202.687%2C6%206%2C6%203.313%2C0%206%2C-2.687%206%2C-6%20l%200%2C-10%204%2C0%200%2C10%20C%2010%2C-4.477%205.523%2C0%200%2C0%22%20id%3D%22path24%22%20style%3D%22fill%3A%23bcbec0%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%2F%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate(31%2C5)%22%20id%3D%22g26%22%3E%3Cpath%20d%3D%22m%200%2C0%20c%200%2C-2.209%20-1.791%2C-4%20-4%2C-4%20l%20-16%2C0%20c%20-2.209%2C0%20-4%2C1.791%20-4%2C4%20l%200%2C10%20c%200%2C2.209%201.791%2C4%204%2C4%20l%2016%2C0%20c%202.209%2C0%204%2C-1.791%204%2C-4%20L%200%2C0%20z%22%20id%3D%22path28%22%20style%3D%22fill%3A%23ffac33%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E">
    </button>

    <script>
        (function () {
            var unlockBtn = document.querySelector( '.unlock' ),
                sleepBtn = document.querySelector( '.sleep' ),
                pin = localStorage.getItem( 'pin' ),
                timeout;

            if ( !pin ) {
                configure();
            }

            function configure () {
                pin = prompt( 'Please enter the pin defined in config.json' );
                localStorage.setItem( 'pin', pin );
            }

            function unlock () {
                sendXhr({ unlock: true });
            }

            function sleep () {
                sendXhr({ sleep: true });
            }

            function onLoad () {
                feedback( this.response );
            }

            function onError ( e ) {
                console.error( e );
            }

            // stop scrolling
            function onTouchMove ( e ) {
                e.preventDefault();
            }

            function feedback ( resp ) {
                clearTimeout( timeout );

                if ( resp.err ) {
                    document.body.classList.add( 'err' );
                    alert( err );
                } else {
                    document.body.classList.add( 'ok' );
                }

                setTimeout( reset, 600 );
            }

            function reset () {
                document.body.classList.remove( 'error', 'ok' );
            }

            function sendXhr ( data ) {
                var xhr = new XMLHttpRequest();
                xhr.onload = onLoad;
                xhr.onerror = onError;
                xhr.responseType = 'json';
                xhr.open( 'post', '/' );
                data.pin = pin;
                xhr.send( JSON.stringify( data ));
            }

            unlockBtn.addEventListener( 'click', unlock );
            sleepBtn.addEventListener( 'click', sleep );
            document.body.addEventListener( 'touchmove', onTouchMove );
        })();
    </script>
</body>
</html>
